function scroll_to_address(e,t){if(void 0!==e&&null!==e){var r=0;r="top"==t?$("#center_panel").height():"bottom"==t?0:window.innerHeight/2;var i=$(".insaddr.addr_"+e);if(void 0!==i&&null!==i&&void 0!==i[0]&&null!==i[0]){var n=i[0].documentOffsetTop()-r;n=Math.max(0,n),$("#center_panel").scrollTo(n,{axis:"y"}),r2ui._dis.scroll_offset=n}}}function handleClick(e){if($(e.target).hasClass("addr")){if($(e.target).hasClass("history")){var t=e.target.className.split(" ").filter(function(e){return"history_idx_"==e.substr(0,"history_idx_".length)});t=String(t).split("_")[2],r2ui.history_idx=t,do_jumpto(r2ui.history[t])}else if($(e.target).hasClass("insaddr")){var r=get_address_from_class(e.target);r2ui._dis.selected=e.target,r2ui._dis.selected_offset=r,rehighlight_iaddress(r),r2ui.history_push(r),render_history();var i,n,r,s=!1;if("flat"==r2ui._dis.display&&(i=$(r2ui._dis.selected).closest(".instructionbox").next().find(".insaddr")[0],$("#gbox .instructionbox").index($(r2ui._dis.selected).closest(".instructionbox")[0])>$("#gbox .instructionbox").length-10&&(s=!0,r=get_address_from_class(i)),n=$(r2ui._dis.selected).closest(".instructionbox").prev().find(".insaddr")[0],$("#gbox .instructionbox").index($(r2ui._dis.selected).closest(".instructionbox")[0])<10&&(s=!0,r=get_address_from_class(n))),"graph"==r2ui._dis.display){var i=$(r2ui._dis.selected).closest(".instruction").next().find(".insaddr")[0];void 0!==i&&null!==i||(i=$(r2ui._dis.selected).closest(".basicblock").next().find(".insaddr")[0]);var n=$(r2ui._dis.selected).closest(".instruction").prev().find(".insaddr")[0];void 0!==n&&null!==n||(n=$(r2ui._dis.selected).closest(".basicblock").prev().find(".insaddr").last()[0])}s&&(r2ui.seek(r,!1),rehighlight_iaddress(r),scroll_to_address(r))}}else if($(e.target).hasClass("fvar")||$(e.target).hasClass("farg")){var d=null,r=get_address_from_class(e.target,"faddr");r2ui._dis.selected=e.target,r2ui._dis.selected_offset=r;var a=e.target.className.split(" ");for(var l in a){var o=a[l];0===o.indexOf("id_")&&(d=o.substring(3))}null!==d&&rehighlight_iaddress(d,"id")}}function handleDoubleClick(e){if($(e.target).hasClass("addr")&&!$(e.target).hasClass("insaddr")){var t=get_address_from_class(e.target);do_jumpto(t)}}function handleKeypress(e){var t=e.keyCode||e.charCode||e.which||0,r=String.fromCharCode(t);if(!e.ctrlKey&&!e.metaKey&&"INPUT"!==$(e.target).prop("tagName")&&"TEXTAREA"!==$(e.target).prop("tagName")&&null===r2ui._dis.renaming){if(" "===r&&(do_switchview(),e.preventDefault()),"m"===r&&"graph"==r2ui._dis.display&&toggle_minimap(),"h"===r&&do_jumpto(r2ui.history_prev()),"l"===r&&do_jumpto(r2ui.history_next()),"j"===r){var i=!1;if($(r2ui._dis.selected).hasClass("insaddr")){var n;if("flat"==r2ui._dis.display&&(n=$(r2ui._dis.selected).closest(".instructionbox").next().find(".insaddr")[0],$("#gbox .instructionbox").index($(r2ui._dis.selected).closest(".instructionbox")[0])>$("#gbox .instructionbox").length-10&&(i=!0)),"graph"==r2ui._dis.display){var n=$(r2ui._dis.selected).closest(".instruction").next().find(".insaddr")[0];void 0!==n&&null!==n||(n=$(r2ui._dis.selected).closest(".basicblock").next().find(".insaddr")[0])}var s=get_address_from_class(n);i?r2ui.seek(s,!1):(r2ui.history_push(s),render_history(),r2ui._dis.selected=n,r2ui._dis.selected_offset=s),rehighlight_iaddress(s),scroll_to_address(s)}}if("k"===r){var i=!1;if($(r2ui._dis.selected).hasClass("insaddr")){var d;if("flat"==r2ui._dis.display&&(d=$(r2ui._dis.selected).closest(".instructionbox").prev().find(".insaddr")[0],$("#gbox .instructionbox").index($(r2ui._dis.selected).closest(".instructionbox")[0])<10&&(i=!0)),"graph"==r2ui._dis.display){var d=$(r2ui._dis.selected).closest(".instruction").prev().find(".insaddr")[0];void 0!==d&&null!==d||(d=$(r2ui._dis.selected).closest(".basicblock").prev().find(".insaddr").last()[0])}var s=get_address_from_class(d);i?r2ui.seek(s,!1):(r2ui.history_push(s),render_history(),r2ui._dis.selected=d,r2ui._dis.selected_offset=s),rehighlight_iaddress(s),scroll_to_address(s)}}if("c"===r&&do_define(r2ui._dis.selected),"u"===r&&do_undefine(r2ui._dis.selected),"g"===r){var a=prompt("Go to");null!==a&&do_jumpto(a)}if(";"===r&&do_comment(r2ui._dis.selected),"n"===r&&do_rename(r2ui._dis.selected,e),"R"===r&&do_randomcolors(),27===t)if(null!==r2ui._dis.renaming)r2ui._dis.renaming.innerHTML=r2ui._dis.renameOldValue,r2ui._dis.renaming=null;else{var l=r2ui.history_prev();void 0!==l&&null!==l&&r2ui.seek(l,!1),scroll_to_address(l)}13===t&&r2ui._dis.goToAddress()}}function do_switchview(){$("#switch_button").text("loading ...");var e=get_address_from_class(r2ui._dis.selected);void 0!==e&&null!==e&&("flat"===r2ui._dis.display?r2ui._dis.display_graph():"graph"===r2ui._dis.display&&r2ui._dis.display_flat(),r2ui.seek(e,!0),scroll_to_address(e)),$("#switch_button").text("switch view")}function do_jumpto(e){var t=$(".insaddr.addr_"+e);t.length>0?(r2ui.history_push(e),r2ui._dis.selected=t[0],r2ui._dis.selected_offset=e,render_history()):r2ui.seek(e,!0),rehighlight_iaddress(e),scroll_to_address(e)}function do_rename(e,t){var r=get_address_from_class(e);if($(e).hasClass("addr")&&$(e).hasClass("flag")){var i="*";$(e).hasClass("function")&&(i="functions"),$(e).hasClass("import")&&(i="functions"),$(e).hasClass("symbol")&&(i="symbols"),$(e).hasClass("reloc")&&(i="relocs"),$(e).hasClass("section")&&(i="sections"),$(e).hasClass("string")&&(i="strings");var n=$(e).html(),s=prompt("New name",n);null!==s&&(rename(r,n,s,i),store_scroll_offset(),r2ui.seek("$$",!1),scroll_to_last_offset())}else if(null===r2ui._dis.renaming&&null!==e&&$(e).hasClass("addr")){if(r2ui._dis.selected=e,r2ui._dis.selected_offset=r,r2ui._dis.renaming=e,r2ui._dis.renameOldValue=e.innerHTML,r2ui._dis.rbox=document.createElement("input"),r2ui._dis.rbox.setAttribute("type","text"),r2ui._dis.rbox.setAttribute("id","rename"),r2ui._dis.rbox.setAttribute("style","border-width: 0;padding: 0;"),r2ui._dis.rbox.setAttribute("onChange","handleInputTextChange()"),$(e).hasClass("insaddr")){var d=get_offset_flag(r);r2ui._dis.rbox.setAttribute("value",d),r2ui._dis.rbox.setSelectionRange(d.length,d.length)}else r2ui._dis.rbox.setAttribute("value",r2ui._dis.renameOldValue),r2ui._dis.rbox.setSelectionRange(r2ui._dis.renameOldValue.length,r2ui._dis.renameOldValue.length);r2ui._dis.renaming.innerHTML="",r2ui._dis.renaming.appendChild(r2ui._dis.rbox),setTimeout("r2ui._dis.rbox.focus();",200),t.returnValue=!1,t.preventDefault()}else null===r2ui._dis.renaming&&null!==e&&$(e).hasClass("faddr")&&(r=get_address_from_class(e,"faddr"),r2ui._dis.selected=e,r2ui._dis.selected_offset=r,r2ui._dis.renaming=e,r2ui._dis.renameOldValue=e.innerText,r2ui._dis.rbox=document.createElement("input"),r2ui._dis.rbox.setAttribute("type","text"),r2ui._dis.rbox.setAttribute("id","rename"),r2ui._dis.rbox.setAttribute("style","border-width: 0;padding: 0;"),r2ui._dis.rbox.setAttribute("onChange","handleInputTextChange()"),r2ui._dis.rbox.setAttribute("value",r2ui._dis.renameOldValue),r2ui._dis.rbox.setSelectionRange(r2ui._dis.renameOldValue.length,r2ui._dis.renameOldValue.length),r2ui._dis.renaming.innerHTML="",r2ui._dis.renaming.appendChild(r2ui._dis.rbox),setTimeout("r2ui._dis.rbox.focus();",200),t.returnValue=!1,t.preventDefault());update_binary_details()}function do_comment(e){var t=get_address_from_class(e),r=prompt("Comment");null!==r&&(r2.cmd("CC "+r+" @ "+t),r2ui.seek(t,!1),scroll_to_address(t))}function do_undefine(e){var t=get_address_from_class(e);r2.cmd("af-"),r2.update_flags(),update_binary_details(),"graph"==r2ui._dis.display&&r2ui._dis.display_flat(),r2ui.seek(t,!1),scroll_to_address(t)}function do_define(e){var t=get_address_from_class(e),r=prompt("Function name?");null!==r&&(r2.cmd("af "+r+" @ "+t),r2.update_flags(),update_binary_details(),r2ui.seek(t,!1),scroll_to_address(t))}function hex_menu_to_console(){if(value="",r2ui._hex.dragEnd>-1&&r2ui._hex.dragStart>-1){if(r2ui._hex.dragEnd+1<r2ui._hex.dragStart){var e=$("span.dword").slice(r2ui._hex.dragEnd,r2ui._hex.dragStart+1).addClass("autohighlighti");for(var t in e)value+=uncolor_dword(e[t].innerHTML)}else{var e=$("span.dword").slice(r2ui._hex.dragStart,r2ui._hex.dragEnd+1);for(var t in e)value+=uncolor_dword(e[t].innerHTML)}var r=$("#cmd_output").text();$("#cmd_output").html(r+"\n"+value)}}function handle_hex_keypress(e){var t=e.keyCode||e.charCode||e.which||0;String.fromCharCode(t)}function scroll_to_hexaddress(e,t){if(void 0!==e&&null!==e){var r=0;r="top"==t?$("#center_panel").height():"bottom"==t?0:window.innerHeight/2;var i=$(".hexaddr.hexaddr_"+e);if(void 0!==i&&null!==i&&void 0!==i[0]&&null!==i[0]){var n=i[0].documentOffsetTop()-r;n=Math.max(0,n),$("#center_panel").scrollTo(n,{axis:"y"}),r2ui._dis.scroll_offset=n}}}function on_hex_scroll(){if(!r2ui._hex.scrolling){r2ui._hex.scrolling=!0;var e=$("#center_panel").scrollTop(),t=$(".hexoffset").height()-$("#center_panel").height();$("#hex_tab");if(0===e){var r=get_hexdump(r2ui._hex.first-r2ui._hex.block+16);for(var i in r2ui._hex.lines)r[i]=r2ui._hex.lines[i];r2ui._hex.lines=r,html="<div class='hex'>",html+=render_hexdump(r2ui._hex.lines),html+="</div>",$("#hex_tab").html(html),scroll_to_hexaddress("0x"+r2ui._hex.first.toString(16),"bottom"),r2ui._hex.first=r2ui._hex.first-r2ui._hex.block+16}else if(e>t-10){var r=get_hexdump(r2ui._hex.last-16);for(var i in r)r2ui._hex.lines[i]=r[i];r2ui._hex.last=r2ui._hex.last-16+r2ui._hex.block,html="<div class='hex'>",html+=render_hexdump(r2ui._hex.lines),html+="</div>",$("#hex_tab").html(html),scroll_to_hexaddress("0x"+r2ui._hex.last.toString(16),"top")}$(".dword").click(function(e){if($(e.target).hasClass("dword")){var t=e.target.className.split(" ").filter(function(e){return"dword_"==e.substr(0,"dword_".length)});$(".autohighlighti").removeClass("autohighlighti"),$("."+t).addClass("autohighlighti")}}),r2ui._hex.scrolling=!1}}function get_hexdump(e){var t={};return r2.cmd("px "+r2ui._hex.block+"@"+e,function(e){var r=e.split("\n");for(var i in r)if(i>1&&i<r.length-1){var n=r[i].split("  ")[0],s=r[i].split("  ")[1].split(" "),d=r[i].split("  ")[2].match(/.{1,2}/g),a={offset:n,dwords:s,text:d};t[n]=a}}),t}function color_dword(e){return e.replace(/(7f)/gi,function(e){return"<font class='ec_b0x7f'>"+e+"</font>"}).replace(/(ff)/gi,function(e){return"<font class='ec_b0xff'>"+e+"</font>"}).replace(/(00)/gi,function(e){return"<font class='ec_b0x00'>"+e+"</font>"})}function uncolor_dword(e){return void 0!==e&&null!==e?e.replace(/(<([^>]+)>)/gi,""):""}function render_hexdump(e){r2ui._hex.scrolling=!0;var t="<div class='hexoffset'><div><div>",r="<div class='hexdump' style='color: white;'>",i="<div class='hextext'>";for(var n in e){var s=e[n];t+="<span class='hexaddr ec_offset hexaddr_"+address_canonicalize(s.offset)+"'>"+s.offset+"</span><br>";for(var d in s.dwords){var a=parseInt(s.offset,16);a+=2*d,dword_offset="0x"+a.toString(16),r+="<span class='dword dword_"+address_canonicalize(dword_offset)+" line_"+address_canonicalize(s.offset)+"'>"+color_dword(s.dwords[d])+"</span> "}r+="<br>";for(var d in s.text){var a=parseInt(s.offset,16);a+=2*d,dword_offset="0x"+a.toString(16),i+="<span class='dword dword_"+address_canonicalize(dword_offset)+"'>"+s.text[d]+"</span>"}i+="<br>"}return i+="</div>",r+="</div>",t+="</div></div></div>",t+r+i}function rangeMouseDown(e){if(isRightClick(e))return!1;var t=$("span.dword");r2ui._hex.dragStart=t.index($(this)),r2ui._hex.isDragging=!0,"undefined"!=typeof e.preventDefault&&e.preventDefault(),document.documentElement.onselectstart=function(){return!1}}function rangeMouseUp(e){if(isRightClick(e))return!1;var t=$("span.dword");r2ui._hex.dragEnd=t.index($(e.target)),r2ui._hex.isDragging=!1,r2ui._hex.dragEnd>-1&&selectRange(),document.documentElement.onselectstart=function(){return!0}}function rangeMouseMove(){if(r2ui._hex.isDragging){var e=$("span.dword");r2ui._hex.dragEnd=e.index($(this)),selectRange()}}function selectRange(){if($("span.dword").removeClass("autohighlighti"),r2ui._hex.dragEnd+1<r2ui._hex.dragStart){var e=$("span.dword").slice(r2ui._hex.dragEnd,r2ui._hex.dragStart+1).addClass("autohighlighti");for(var t in e)if(void 0!==e[t].className){var r=e[t].className.split(" ").filter(function(e){return"dword_"==e.substr(0,"dword_".length)});$("."+r).addClass("autohighlighti")}}else{var e=$("span.dword").slice(r2ui._hex.dragStart,r2ui._hex.dragEnd+1);for(var t in e)if(void 0!==e[t].className){var r=e[t].className.split(" ").filter(function(e){return"dword_"==e.substr(0,"dword_".length)});$("."+r).addClass("autohighlighti")}}}function isRightClick(e){return e.which?3==e.which:!!e.button&&2==e.button}function handleInputHexChange(){if(null!==r2ui._hex.renaming&&r2ui._hex.rbox.value.length>0){var e=r2ui._hex.rbox.value;if(e=e.match(/^[0-9a-f]{0,4}$/gi),null===e&&(alert("Invalid dword"),e=r2ui._hex.renameOldValue),e.length<4){for(var t="0",r=5-e.length,i=0;i<r;i++)t+="0";e=(t+e).slice(r*-1)}e!==r2ui._hex.renameOldValue&&(r2.cmdj("wx 0x"+e.substring(0,2)+" @ "+parseInt(r2ui._hex.dword,16),function(){}),r2.cmdj("wx 0x"+e.substring(2,4)+" @ "+(parseInt(r2ui._hex.dword,16)+1),function(){})),r2ui._hex.renaming[0].innerHTML="<span class='dword dword_"+r2ui._hex.dword+" line_"+r2ui._hex.address+"'>"+color_dword(e)+"</span>",$(".autohighlighti").removeClass("autohighlighti"),$(".dword_"+r2ui._hex.dword).addClass("autohighlighti"),r2ui._hex.renaming=null,r2ui._hex.rbox=null}}function handle_hex_double_click(e){if($(e.target).hasClass("hexaddr")){var t=get_address_from_class(e.target,"hexaddr");return console.log(t),void(r2ui._dis.selected_offset=t)}var r=!0;if(r2.cmdj("ij",function(e){e.core.mode.indexOf("w")==-1&&(r=!1,alert("Not in write mode"))}),r){var i=null;if($(e.target).hasClass("dword"))i=$(e.target);else{if(!$(e.target).parent().hasClass("dword"))return;i=$(e.target).parent()}if(null===r2ui._hex.renaming&&null!==i&&i.hasClass("dword")){var n=i[0].className.split(" "),s=0,d=0;for(var a in n)n[a].indexOf("dword_")>-1?s=n[a].substr(6):n[a].indexOf("line_")>-1&&(d=n[a].substr(5));r2ui._hex.dword=s,r2ui._hex.address=d,r2ui._hex.renaming=i,r2ui._hex.renameOldValue=uncolor_dword(i[0].innerHTML);var l=document.createElement("form");l.setAttribute("onSubmit","handleInputHexChange(); return false;"),l.setAttribute("style","display:inline;"),r2ui._hex.rbox=document.createElement("input"),r2ui._hex.rbox.setAttribute("type","text"),r2ui._hex.rbox.setAttribute("id","rename"),r2ui._hex.rbox.setAttribute("style","border-width: 0;padding: 0; background-color:yellow; font-family: monospace; font-size: 10pt;"),r2ui._hex.rbox.setAttribute("size","4"),r2ui._hex.rbox.setAttribute("maxlength","4"),r2ui._hex.rbox.setAttribute("value",r2ui._hex.renameOldValue),r2ui._hex.rbox.setSelectionRange(r2ui._hex.renameOldValue.length,r2ui._hex.renameOldValue.length),r2ui._hex.renaming[0].innerHTML="",l.appendChild(r2ui._hex.rbox),r2ui._hex.renaming[0].appendChild(l),setTimeout("r2ui._hex.rbox.focus();",200),e.returnValue=!1,e.preventDefault()}}}function highlight_in(e){var t=null;if($(e.target).hasClass("dword"))t=e.target;else{if(!$(e.target).parent().hasClass("dword"))return;t=$(e.target).parent()[0]}var r=t.className.split(" ").filter(function(e){return"dword_"==e.substr(0,"dword_".length)});$("."+r).addClass("autohighlighti")}function highlight_out(){r2ui._hex.isDragging||$(".autohighlighti").removeClass("autohighlighti")}function highlight_dword(e){if($(e.target).hasClass("dword")){var t=e.target.className.split(" ").filter(function(e){return"dword_"==e.substr(0,"dword_".length)});$(".autohighlighti").removeClass("autohighlighti"),$("."+t).addClass("autohighlighti")}}var DisasmPanel=function(){this.display="flat",this.min=0,this.max=0,this.block=512,this.base="entry0",this.selected=null,this.selected_offset=null,this.tmp_address=null,this.renaming=null,this.renameOldValue="",this.rbox=null,this.panel=$("#disasm_tab")[0],this.scroll_offset=null,this.minimap=!0,this.instructions=[],this.scrolling=!1};DisasmPanel.prototype.render=function(e){$("#center_panel").unbind("click"),$(document).unbind("keypress"),$(document).unbind("click"),$(document).unbind("dblclick"),$("#center_panel").scroll(on_scroll),$(document).keypress(handleKeypress),$(document).click(handleClick),$(document).dblclick(handleDoubleClick),$(document).contextmenu({delegate:".addr",menu:[{title:"jump to address<kbd>g</kbd>",cmd:"goto"},{title:"rename<kbd>n</kbd>",cmd:"rename"},{title:"add comment<kbd>;</kbd>",cmd:"comment"},{title:"code<kbd>c</kbd>",cmd:"define"},{title:"undefine<kbd>u</kbd>",cmd:"undefine"},{title:"random colors<kbd>R</kbd>",cmd:"randomcolors"},{title:"switch disasm/graph<kbd>s</kbd>",cmd:"switchview"}],preventSelect:!0,taphold:!0,preventContextMenuForPopup:!0,show:!1,position:function(e,t){return{my:"left+100 top-10",at:"left bottom",of:t.target}},beforeOpen:function(e,t){var r=get_address_from_class(t.target[0]),i=[],n=[],s=null,d=null;if(r2.cmd("axf @"+r,function(e){var t=e.split("\n");for(var r in t)""!==t[r]&&(i[i.length]=t[r])}),i.length>0){$(document).contextmenu("showEntry","xrefs_to",!0);var a=[];for(var l in i){var o=i[l].split(" ")[1],u=i[l].split(" ")[0];a[a.length]={title:o+"<kbd>"+u+"</kbd>",cmd:"jumpto_"+o}}var s={title:"xrefs to",children:a}}if(r2.cmd("axt @"+r,function(e){var t=e.split("\n");for(var r in t)""!==t[r]&&(n[n.length]=t[r])}),n.length>0){$(document).contextmenu("showEntry","xrefs_from",!0);var a=[];for(var l in n){var o=n[l].split(" ")[1],u=n[l].split(" ")[0];a[a.length]={title:o+"<kbd>"+u+"</kbd>",cmd:"jumpto_"+o}}var d={title:"xrefs from",children:a}}var c=[{title:"jump to address<kbd>g</kbd>",cmd:"goto"},{title:"rename<kbd>n</kbd>",cmd:"rename"},{title:"add comment<kbd>;</kbd>",cmd:"comment"},{title:"code<kbd>c</kbd>",cmd:"define"},{title:"undefine<kbd>u</kbd>",cmd:"undefine"},{title:"random colors<kbd>R</kbd>",cmd:"randomcolors"},{title:"switch disasm/graph<kbd>s</kbd>",cmd:"switchview"}];null===d&&null===s||(null!==s&&(c[c.length]=s),null!==d&&(c[c.length]=d)),$(document).contextmenu("replaceMenu",c),r2.cmdj("pdj 1 @"+r,function(e){e&&(e[0].fcn_addr==e[0].offset?($(document).contextmenu("showEntry","define",!1),$(document).contextmenu("showEntry","undefine",!0)):($(document).contextmenu("showEntry","define",!0),$(document).contextmenu("showEntry","undefine",!1)))}),t.target.hasClass("insaddr")?($(document).contextmenu("showEntry","comment",!0),$(document).contextmenu("showEntry","rename",!0)):($(document).contextmenu("showEntry","comment",!1),$(document).contextmenu("showEntry","rename",!0),$(document).contextmenu("showEntry","define",!1),$(document).contextmenu("showEntry","undefine",!1)),(t.target.hasClass("reloc")||t.target.hasClass("symbol")||t.target.hasClass("import"))&&($(document).contextmenu("showEntry","comment",!1),$(document).contextmenu("showEntry","rename",!1),$(document).contextmenu("showEntry","define",!1),$(document).contextmenu("showEntry","undefine",!1)),$.contains($("#disasm_tab")[0],t.target[0])||$(document).contextmenu("showEntry","switchview",!1)},select:function(e,t){$(document).contextmenu("close");var r=t.target[0],i=get_address_from_class(r);switch(0==t.cmd.indexOf("jumpto_")&&(i=t.cmd.substring(t.cmd.indexOf("jumpto_")+7),do_jumpto(i)),t.cmd){case"goto":do_goto();break;case"comment":do_comment(r);break;case"rename":do_rename(r,e);break;case"define":do_define(r);break;case"undefine":do_undefine(r);break;case"randomcolors":do_randomcolors(r);break;case"switchview":do_switchview(r)}}}),"flat"===e?this.display_flat():"graph"===e&&this.display_graph();var t=null;t=null!==this.selected_offset?this.selected_offset:this.base,r2ui.seek(t,!0),t=0===t.indexOf("0x")?address_canonicalize(t):r2.get_flag_address(t),scroll_to_address(t)},DisasmPanel.prototype.seek=function(e){var t=this.panel,r=!1;"graph"===this.display&&(t.innerHTML="",r2.cmd("agj "+e,function(e){t.innerHTML="<div id='minimap'></div></div><div id='canvas' class='canvas enyo-selectable ec_gui_background'></div>",render_graph(e)===!1&&(r=!0)})),r&&this.display_flat(),"flat"===this.display&&(this.min=this.max=0,r2.get_disasm_before_after(e,-100,100,function(e){t.innerHTML="<div id='canvas' class='canvas enyo-selectable ec_gui_background'></div>",r2ui._dis.instructions=e,render_instructions(r2ui._dis.instructions)})),this.selected=get_element_by_address(e),this.selected_offset=e,render_history(),rehighlight_iaddress(e)},DisasmPanel.prototype.display_graph=function(){this.display="graph",$("#main_panel").removeClass("ec_gui_background"),$("#main_panel").addClass("ec_gui_alt_background"),$("#minimap").length&&($("#minimap")[0].innerHTML="")},DisasmPanel.prototype.display_flat=function(){this.display="flat",$("#main_panel").removeClass("ec_gui_alt_background"),$("#main_panel").addClass("ec_gui_background"),$("#minimap").length&&($("#minimap")[0].innerHTML="")},DisasmPanel.prototype.goToAddress=function(){if(null===this.renaming&&null!==this.selected&&this.selected.className.indexOf(" addr ")>-1){var e=get_address_from_class(this.selected);if(this.selected.className.indexOf("ec_gui_dataoffset")>-1)return void r2ui.openpage(e,2);void 0!==e&&null!==e&&(e=address_canonicalize(e),do_jumpto(e))}},DisasmPanel.prototype.handleInputTextChange=function(){if(null!==this.renaming&&this.rbox.value.length>0){if($(this.selected).hasClass("insaddr")){var e=get_offset_flag(r2ui._dis.selected_offset),t="offsets";r2.cmdj("afij @ "+r2ui._dis.selected_offset,function(e){null!==e&&void 0!==e&&"0x"+e[0].offset.toString(16)===r2ui._dis.selected_offset&&(t="functions")}),rename(r2ui._dis.selected_offset,e,this.rbox.value,t)}else if($(this.selected).hasClass("faddr"))$(this.selected).hasClass("fvar")?r2.cmd("afvn "+r2ui._dis.renameOldValue+" "+r2ui._dis.rbox.value+" @ "+r2ui._dis.selected_offset,function(){}):$(this.selected).hasClass("farg")&&r2.cmd("afan "+r2ui._dis.renameOldValue+" "+r2ui._dis.rbox.value+" @ "+r2ui._dis.selected_offset,function(){});else{var e=r2ui._dis.renameOldValue;0===e.indexOf("0x")&&(e=""),rename(r2ui._dis.selected_offset,e,r2ui._dis.rbox.value,"*")}var r;"flat"==this.display&&(r=$(this.selected).closest(".instructionbox").find(".insaddr")[0]),"graph"==this.display&&(r=$(this.selected).closest(".instruction").find(".insaddr")[0]),this.renaming=null;var i=get_address_from_class(r);update_binary_details(),r2ui.seek(i,!1),scroll_to_address(i)}};var EntropyPanel=function(){};EntropyPanel.prototype.render=function(){var e="<table id='entropy_chart'>";r2.cmd("p=",function(t){var r=t.split("\n");for(var i in r){var n=r[i],s=n.split(" ")[0],d=parseInt(n.split(" ")[1],16);d>0&&(e+="<tr><td>"+s+"</td><td>"+d+"</td></tr>")}}),e+="</table>",$("#entropy_tab").html("<pre id='hexdump' style='color:rgb(127,127,127);''>"+e+"</pre>"),$("#entropy_chart").horizontalTableGraph()},jQuery.fn.horizontalTableGraph=function(){$(this).find("thead").remove();var e=0;$(this).find("tr").each(function(){$(this).removeClass(),$(this).find("td").eq(0).animate({width:"50px"},1e3),$(this).find("td").eq(1).animate({width:"500px"},1e3).css("text-align","left"),$(this).find("td").eq(1).css("width","500px");var t=$(this).find("td").eq(1).html();e=Math.max(e,t)}),$(this).find("tr").each(function(){var t=$(this).find("td").eq(1).html(),r=$("<span>").html(t);r.css({display:"block",width:"0px",backgroundColor:"#600",marginBottom:"0px",padding:"0px",color:"#FFF"}),$(this).find("td").eq(1).html(r),r.animate({width:100*t/e+"%"},"slow")})};var HexPanel=function(){this.block=1024,this.base="entry0",this.first=0,this.last=0,this.lines={},this.scrolling=!1,this.renaming=null,this.dwors=null,this.renameOldValue="",this.rbox=null,this.address=null,this.scroll_offset=0,this.dragStart=-1,this.dragEnd=-1,this.isDragging=!1};HexPanel.prototype.scrollTo=function(){},HexPanel.prototype.render=function(){r2ui.seek("$$",!1),$("#center_panel").unbind("click"),$(document).unbind("keypress"),$(document).unbind("click"),$(document).unbind("dblclick"),$("#center_panel").scroll(on_hex_scroll),$(document).keypress(handle_hex_keypress),$(document).dblclick(handle_hex_double_click),$("#center_panel").contextmenu({delegate:".dword",menu:[{title:"bytes to console",cmd:"hex_menu_to_console"}],preventSelect:!0,preventContextMenuForPopup:!0,show:!1,select:function(e,t){switch($(document).contextmenu("close"),t.cmd){case"hex_menu_to_console":hex_menu_to_console()}}})},HexPanel.prototype.seek=function(e){this.base=e,this.first=parseInt(e,16),this.last=parseInt(e,16)+this.block,this.lines=get_hexdump(e),html="<div class='hex'>",html+=render_hexdump(this.lines),html+="</div>",$("#hex_tab").html(html),$(document).on("dblclick",".dword",handle_hex_double_click),$(document).on("mousedown",".dword",rangeMouseDown),$(document).on("mousemove",".dword",rangeMouseMove),$(document).on("mouseup",".dword",rangeMouseUp),r2ui._hex.scrolling=!1};var output=[],logger=null,LogsPanel=function(){};LogsPanel.prototype.render=function(){function e(e){return e.replace(/[\x26\x0A\<>'"]/g,function(e){return"&#"+e.charCodeAt(0)+";"})}function t(){console.log("loginit",logger);var t=document.getElementById("logs_out");null===logger&&(logger=r2.getTextLogger()),logger.render=function(){t.innerHTML=output.join("<br />")},logger.on("message",function(t){output.push(e(t.text)),logger.render()}),logger.render(),logger.autorefresh(3)}function r(){var e=document.getElementById("logs_nick").value.trim(),r=document.getElementById("logs_input").value.trim();t(),r&&logger&&(e&&(r="<"+e+"> "+r),logger.send(r)),document.getElementById("logs_input").value=""}$("#logs_tab").html('<div><table width="100%"><tr><td><input class="input" id="logs_nick" style="width:4em" value="user" /></td><td width="100%"><input class="input" id="logs_input" style="width:100%" /></td><td><input type="button" class="button" id="logs_button" value="send" style="z-index:-20" /></td></tr></table><div id="logs_out" class="consoleout" style="z-index:-20"> </div></div>'),r2ui.selected_panel="Logs",$(document).ready(t),$("#logs_input").keypress(function(e){13==e.which&&r()}),$("#logs_button").click(r)};var ProjectsPanel=function(){};ProjectsPanel.prototype.render=function(){$("#projects_tab").html('<div><div style="color: white;">Open Project:</div><div id="projects" style="color:rgb(127,127,127);"></div><div id="button"><br/><input id="submit" type="submit" value="Save Project" /></div></div>'),r2.cmdj("Plj",function(e){var t=[];for(var r in e){var i=e[r],n={label:i};t[t.length]=n}$("#projects").tree({data:[],selectable:!1,slide:!1,useContextMenu:!1}),$("#projects").tree("loadData",t),$("#submit").on("click",function(){var e=prompt("Project Name:",r2.project_name);""!==e?r2.cmd(":Ps "+e,function(){}):alert("Enter a valid name"),r2.project_name=e}),$(".jqtree-element").on("click",function(){var e=$(this)[0].firstChild.innerText;r2.cmd("Po "+e,function(){}),r2.project_name=e,window.location.assign("./p")})})};var SettingsPanel=function(){};SettingsPanel.prototype.render=function(){var e='<div><h3>Colors:</h3><br/><iframe id="colors_frame" name="colors_frame" src="colors.html" width="100%" height="400px"></iframe></div><br/>',t="<div><h3>Settings:</h3><br/>";t+='<div>Test: <input id="test" type="checkbox" /></div>',t+="</div><br/>",t+='<div><input value="Randomize colors" type="button" onclick="r2.cmd(\'ecr\');"></div>';var r=t+e;$("#settings_tab").html(r),$("#settings_tab").css("color","rgb(127,127,127);"),$("input[type=checkbox]").onoff()};var StringsPanel=function(){};StringsPanel.prototype.render=function(){$("#strings_tab").html('<div id="strings" style="color:rgb(127,127,127);"></div>'),$("#strings").before('<div class="ui-toolbar ui-widget-header ui-helper-clearfix" style="padding:5px;"><input id="search_string" type="text" placeholder="Search "><input id="string_length" type="text" placeholder="Length" style="margin-left:50px;"></div>'),r2.cmdj("izj",function(e){var t=[];for(var r in e){var i=e[r],n={offset:i.paddr,label:atob(i.string),children:[{label:"vaddr: 0x"+i.vaddr.toString(16)},{label:"paddr: 0x"+i.paddr.toString(16)},{label:"length: "+i.length},{label:"type: "+i.type}]};t[t.length]=n}t=t.sort(function(e,t){return e.offset-t.offset}),$("#strings").tree({data:[],selectable:!1,slide:!1,useContextMenu:!1}),$("#strings").tree("loadData",t)}),$("#search_string").change(function(){str=$("#search_string").val(),0==str.length?StringsPanel.prototype.render():r2.cmdj("izj",function(e){var t=[];for(var r in e){var i=e[r];if(str.toLowerCase(),str1=atob(i.string).slice(0,-1),str1.toLowerCase(),$("#string_length").val()){if(len=$("#string_length").val(),str1.indexOf(str)>=0&&i.length==len){var n={offset:i.paddr,label:atob(i.string),children:[{label:"vaddr: 0x"+i.vaddr.toString(16)},{label:"paddr: 0x"+i.paddr.toString(16)},{label:"length: "+i.length},{label:"type: "+i.type}]};t[t.length]=n}}else if(str1.indexOf(str)>=0){var n={offset:i.paddr,label:atob(i.string),children:[{label:"vaddr: 0x"+i.vaddr.toString(16)},{label:"paddr: 0x"+i.paddr.toString(16)},{label:"length: "+i.length},{label:"type: "+i.type}]};t[t.length]=n}}t=t.sort(function(e,t){return e.offset-t.offset}),$("#strings").tree({data:[],selectable:!1,slide:!1,useContextMenu:!1}),$("#strings").tree("loadData",t)})}),$("#string_length").change(function(){0==$("#string_length").val()||"undefined"==$("#string_length").val()?StringsPanel.prototype.render():r2.cmdj("izj",function(e){var t=[];for(var r in e){var i=e[r];if(str=$("#search_string").val(),str.toLowerCase(),str1=atob(i.string).slice(0,-1),str1.toLowerCase(),str.length>0&&$("#string_length").val()){if(len=$("#string_length").val(),i.length==len&&str1.indexOf(str)>=0){var n={offset:i.paddr,label:atob(i.string),children:[{label:"vaddr: 0x"+i.vaddr.toString(16)},{label:"paddr: 0x"+i.paddr.toString(16)},{label:"length: "+i.length},{label:"type: "+i.type}]};t[t.length]=n}}else if(len=$("#string_length").val(),i.length==len){var n={offset:i.paddr,label:atob(i.string),children:[{label:"vaddr: 0x"+i.vaddr.toString(16)},{label:"paddr: 0x"+i.paddr.toString(16)},{label:"length: "+i.length},{label:"type: "+i.type}]};t[t.length]=n}}t=t.sort(function(e,t){return e.offset-t.offset}),$("#strings").tree({data:[],selectable:!1,slide:!1,useContextMenu:!1}),$("#strings").tree("loadData",t)})})};var TypesPanel=function(){this.data=[],this.optionSpacer=300};TypesPanel.prototype.insertData=function(e,t,r){"undefined"==typeof r&&(r=this.data);var i=e[0].trim();if(1==e.length)return void r.push({label:i,id:i,value:t});if(r.length<1)return r.push({label:i,children:[]}),void this.insertData(e.slice(1),t,r[0].children);for(var n in r)if(r[n].hasOwnProperty("label")&&r[n].label===i){if(r[n].hasOwnProperty("children"))return void this.insertData(e.slice(1),t,r[n].children);if(e.length>1)return r[n].children=[],void this.insertData(e.slice(1),t,r[n].children)}r.push({label:i}),e.length>1&&(r[r.length-1].children=[],this.insertData(e.slice(1),t,r[r.length-1].children))},TypesPanel.prototype.generateContent=function(){var e=this;r2.cmd("tk",function(t){var r=t.split("\n");for(var i in r){var n=r[i].split("=");if(!(n.length<2)){var s=n[0].split("."),d=n[1];s.length<2||e.insertData(s,d)}}})},TypesPanel.prototype.createBarButtons=function(){var e=$("#typesButtonBar"),t=$('<button id="addButton">Add type</button>');t.click(function(){var e=prompt("Enter C string:");r2.cmd('"td '+e+'"',function(){r2ui._typ.render()})}),e.append(t)},TypesPanel.prototype.createTree=function(){var e=$("#types");e.tree({data:this.data,slide:!1,autoOpen:0,useContextMenu:!1,selectable:!1,onCreateLi:function(e,t){var r="";if("undefined"!=typeof e.value&&(r+=" ("+e.value+")"),2==e.getLevel()){var i=r2ui._typ.optionSpacer;e.children&&0!=e.children.length&&(i-=5);var n="font-size: 80%; font-style: normal; font-family: monospace; cursor: pointer; position: absolute; left:"+i+"px";r+='<i class="remove" style="'+n+'"data-node-name="'+e.name+'">[-]</i>'}t.find(".jqtree-element").append(r)}}),e.on("click",".remove",function(e){var t=$(e.target).data("node-name");r2.cmd("t- "+t,function(){r2ui._typ.render()})})},TypesPanel.prototype.render=function(){$("#types_tab").html('<div id="typesButtonBar"></div><div id="types" style="color:rgb(127,127,127)"></div>'),
this.createBarButtons(),this.data=[],this.maxstr=0,this.generateContent(),this.createTree()};